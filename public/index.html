<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aetheron's Tech Radar — Our Opinionated Tech Stack</title>
    <link rel="icon" href="https://www.aetheron.com/favicon.ico" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="vendor/radar-0.12.js"></script>

    <style>
      :root {
        --bg-0: #061c1d;
        --bg-1: #0c2a2c;
        --card: #0e2324;
        --card-border: #183b3d;
        --text-1: #eaf4f4;
        --text-2: #cfe7e6;
        --grid: #2b4f51;
        --muted: #86a8a9;
      }

      /* Allow all layout containers to shrink on small viewports */
      .page, .grid, .card, .intro, .library, .radar-col, .radar-wrap, #radar, .controls, .list, .details {
        min-width: 0;
      }

      html, body {
        height: 100%;
        overflow-x: hidden; /* prevent horizontal scroll */
      }

      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--text-1);
        background: radial-gradient(1200px 800px at 30% 10%, var(--bg-1), var(--bg-0));
      }
      /* Leave body scroll enabled; we'll constrain internal panels instead */

      .page {
        max-width: 1400px;
        margin:  auto;
        padding: 0; /* remove all padding to prevent overflow */
        height: 100vh;
        box-sizing: border-box;
        display: flex;
        align-items: center;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45), inset 0 1px 0 rgba(255, 255, 255, 0.03);
        padding: 28px 28px 28px; /* increase bottom padding inside the card */
        margin: 0 24px; /* only horizontal margin when centered */
        box-sizing: border-box;
        width: calc(100% - 48px);
        max-height: calc(100vh - 32px);
        overflow: hidden;
      }

      .title {
        margin: 6px 6px 20px;
        font-size: clamp(24px, 3.3vw, 44px);
        font-weight: 700;
        letter-spacing: -0.02em;
        display: inline-flex;
        align-items: center;
        gap: 14px;
      }
      .brand-logo-crop {
        height: 52px;
        width: 52px; /* crop to hide the wordmark portion */
        overflow: hidden;
        border-radius: 6px;
        display: inline-block;
        transform: translateY(0);
      }
      .brand-logo-crop .brand-logo {
        height: 52px;
        width: auto;
        object-fit: cover;
      }
      .brand-name { font-weight: 700; opacity: .95; }
      .product-title { font-weight: 800; }

      .subtitle {
        margin: 0 6px 4px;
        color: var(--muted);
        font-weight: 500;
      }

      .grid {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr; /* left: title+radar, right: library */
        grid-template-rows: auto 1fr; /* compact first row */
        grid-template-areas:
          "intro library"
          "radar library";
        gap: 16px;
        align-items: start;
        height: 100%;
      }

      @media (max-width: 980px) {
        .grid {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto auto; /* stack all rows, no overlap */
          grid-template-areas:
            "intro"
            "library"
            "radar";
          gap: 12px;
        }
        .library {
          position: static !important; /* disable sticky on mobile */
          height: auto !important;
          z-index: auto;
        }
        .radar-wrap {
          min-height: 360px;
          margin-top: 8px; /* ensure visual separation from library */
        }
      }

      .radar-wrap { 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        width: 100%; 
        height: 100%;
        padding: 12px; /* ensure breathing room around the SVG */
        overflow: hidden; 
        border-radius: 12px; 
        min-height: 400px; /* slight reduction to curb overflow */
      }

      .intro { grid-area: intro; }
      .radar-col { 
        grid-area: radar; 
        display: flex;
        align-items: center;
        min-height: 500px;
      }
      .library { grid-area: library; }

      /* Library panel */
      .library {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 16px;
        position: sticky;
        top: 16px; /* keeps a comfortable space above */
        /* Constrain height to prevent overflow */
        max-height: calc(100vh - 120px); /* viewport minus card margins and spacing */
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      .library h2 { margin: 4px 2px 6px; font-size: 18px; letter-spacing: 0; }
      .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 6px; margin-bottom: 8px; }
      .controls input, .controls select {
        width: 100%;
        background: #0b1d1e; border: 1px solid #173a3b; color: var(--text-1);
        border-radius: 8px; padding: 5px 8px; font-family: inherit; font-size: 13px;
      }
      @media (max-width: 520px) {
        .controls { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      }
      .legend-row { display: flex; gap: 10px; align-items: center; margin: 8px 0 10px; color: var(--muted); font-size: 12px; }
      .ring-dot { width: 8px; height: 8px; border-radius: 999px; display: inline-block; margin-right: 6px; }

      .list { display: grid; gap: 6px; overflow: auto; padding-right: 6px; flex: 1; min-height: 0; overscroll-behavior: contain; padding-top: 4px; padding-bottom: 6px; }
      .item { padding: 10px; border: 1px solid #173a3b; border-radius: 10px; background: #0b1d1e; cursor: pointer; transition: border-color .15s ease, background .15s ease; display: grid; grid-template-columns: 28px 1fr; gap: 10px; align-items: center; }
      .item:hover { border-color: #2b4f51; background: #0e2122; }
      .item.selected { border-color: #13a3b0; background: rgba(19, 163, 176, 0.15); box-shadow: 0 0 0 1px rgba(19, 163, 176, 0.3); }
      .item.highlighted { border-color: #13a3b0; background: rgba(19, 163, 176, 0.1); animation: pulse-highlight 1.5s ease-out; }
      .item .logo { 
        width: 22px; 
        height: 22px; 
        padding: 2px; 
        border-radius: 4px; 
        object-fit: contain; 
        background: transparent; 
        border: 1px solid #173a3b; 
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
        filter: brightness(0) invert(1); /* force white */
      }
      .item .logo-letter { 
        width: 22px;
        height: 22px;
        padding: 2px;
        border-radius: 4px;
        display: flex; 
        align-items: center; 
        justify-content: center; 
        font-weight: 700; 
        font-size: 12px; 
        color: #ffffff; 
        background: transparent; 
        border: 1px solid #173a3b; 
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      }
      
      @keyframes pulse-highlight {
        0% { box-shadow: 0 0 0 0 rgba(19, 163, 176, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(19, 163, 176, 0); }
        100% { box-shadow: 0 0 0 0 rgba(19, 163, 176, 0); }
      }
      .item .name { font-weight: 600; }
      .badge { display: inline-block; font-size: 12px; padding: 2px 8px; border-radius: 999px; border: 1px solid #244748; color: var(--text-2); margin-left: 6px; }
      .badge.ring-0 { border-color: #355d0a; background: rgba(91,163,0,.1); }
      .badge.ring-1 { border-color: #0c6f7a; background: rgba(19,163,176,.1); }
      .badge.ring-2 { border-color: #6a5f00; background: rgba(199,186,0,.1); }
      .badge.ring-3 { border-color: #7a3c36; background: rgba(224,155,150,.1); }

      .details { margin-top: 12px; border-top: 1px dashed #254a4b; padding-top: 12px; max-height: 35%; overflow: auto; position: relative; overscroll-behavior: contain; padding-bottom: 6px; }
      .details .close-btn {
        position: absolute;
        top: 6px;
        right: 6px;
        width: 28px;
        height: 28px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        border: 1px solid #203f40;
        background: #0b1d1e;
        color: var(--muted);
        cursor: pointer;
      }
      .details .close-btn:hover { background: #0e2122; color: var(--text-2); border-color: #2b4f51; }
      /* When an item is selected, keep details sized to content (not full height) */
      .library.has-selection { gap: 8px; }
      .library.has-selection .list { flex: 1 1 auto; }
      .library.has-selection .details { flex: 0 0 auto; max-height: min(420px, 60vh); }
      .details h3 { margin: 0 0 8px; }
      .details .meta { color: var(--muted); font-size: 13px; margin-bottom: 8px; }
      .details ul { margin: 6px 0 0 18px; }
      .details .detail-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
      .details .logo { 
        width: 44px; height: 44px; padding: 2px; border-radius: 6px; 
        object-fit: contain; background: transparent; border: 1px solid #173a3b; 
        box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); filter: brightness(0) invert(1);
      }
      .details .logo-letter { 
        width: 44px; height: 44px; padding: 2px; border-radius: 6px; 
        display: flex; align-items: center; justify-content: center; 
        font-weight: 700; font-size: 24px; color: #ffffff; background: transparent; 
        border: 1px solid #173a3b; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02);
      }

      /* Tweak the generated SVG to fit the dark theme */
      #radar { 
        width: 100%; 
        height: auto; /* let aspect ratio control the height */
        display: block; 
        max-width: 100%;
      }
      #radar text { fill: var(--text-2) !important; font-weight: 500; }
      #radar .legend text { fill: var(--text-1) !important; }
      #radar .legend tspan { fill: var(--text-2) !important; }
      #radar g.blip.dim { opacity: .25; }
      #radar g.blip.highlighted { opacity: 1 !important; }
      #radar g.blip.highlighted circle, #radar g.blip.highlighted polygon { stroke: #eaf4f4 !important; stroke-width: 2px !important; }
      #radar .quadrant-label { fill: var(--text-2); opacity: 0.60; font-weight: 600; font-size: 20px; pointer-events: none; }
      /* Ensure blips are fully clickable */
      #radar g.blip { pointer-events: all; }
      #radar g.blip * { pointer-events: all; cursor: pointer; }
      /* Hide the radar library's built-in legend */
      #radar .legend { display: none !important; }
    </style>
  </head>

  <body>
    <main class="page">
      <section class="card">
        <div class="grid">
          <div class="intro">
        <h1 class="title">
          <span class="brand-logo-crop"><img class="brand-logo" src="https://www.aetheron.com/images/aetheron-logo-secondary.png" alt="Aetheron" /></span>
          <span>Aetheron Tech Radar</span>
        </h1>
        <p class="subtitle">Our opinionated tech stack. The tools we back as Primary, the options we Consider, what we Experiment with, and what we Avoid. Built to share our defaults, speed decisions, and spark healthy debate.</p>
          </div>
          <aside class="library">
            <h2>Tech Stack Library</h2>
            <div class="controls">
              <input id="search" type="search" placeholder="Search…" />
              <select id="quadrantFilter"></select>
              <select id="ringFilter"></select>
            </div>
            <div class="legend-row" id="ringLegend"></div>
            <div id="list" class="list"></div>
            <div id="details" class="details" hidden></div>
          </aside>
          <div class="radar-col">
            <div id="radar-container" class="radar-wrap">
<svg id="radar"></svg>
            </div>
          </div>
        </div>
      </section>
    </main>

<script>
      // ====================================
      // RADAR ENTRIES - Edit tech stack here
      // ====================================
      let RADAR_ENTRIES = [];

      async function loadEntries() {
        try {
          const r = await fetch('radar-entries.json', { cache: 'no-store' });
          if (!r.ok) throw new Error('HTTP ' + r.status);
          RADAR_ENTRIES = await r.json();
        } catch (err) {
          console.error('Failed to load radar entries:', err);
          RADAR_ENTRIES = [];
        }
        initializeRadar();
      }

      // ====================================
      // Configuration Constants
      // ====================================
      const QUADRANTS = [
        { name: "Infrastructure" },
        { name: "Languages & Frameworks" },
        { name: "Services & LLMs" },
        { name: "Tools & Methodologies" },
      ];

      const RINGS = [
        { name: "Primary",    color: "#5ba300" },
        { name: "Consider",   color: "#13a3b0" },
        { name: "Experiment", color: "#c7ba00" },
        { name: "Avoid",      color: "#e09b96" },
      ];
      const RING_ORDER = [0, 1, 2, 3]; // Primary -> Consider -> Experiment -> Avoid

      // ====================================
      // Radar Visualization Functions
      // ====================================
      function drawRadar() {
        const container = document.getElementById("radar-container");
        const containerWidth = container.clientWidth;
        const containerHeight = container.clientHeight || window.innerHeight * 0.7;
        
        // Make the radar a square that fits in the container
        const maxSize = Math.min(containerWidth, containerHeight, 1200);
        const size = Math.max(400, maxSize * 0.9); // Leave some padding
        
        // Clear previous drawing
        d3.select("#radar").selectAll("*").remove();

  radar_visualization({
    svg_id: "radar",
          width: size,
          height: size,
          title: "",
          print_layout: true,
          colors: {
            background: "#0e2324",
            grid: "#2b4f51",
            inactive: "#294546",
          },
          font_family: "Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial",
          quadrants: QUADRANTS,
          rings: RINGS,
          entries: RADAR_ENTRIES,
        });

        // Set viewBox to properly center the radar
        const svg = d3.select("#radar");
        svg.attr("preserveAspectRatio", "xMidYMid meet");
        
        // The radar group is nudged vertically in the vendor lib; reflect that in the viewBox
        const radarRadius = 400;
        const padding = 10; // Minimal padding for maximum radar size
        const nudgeY = -20; // must match verticalNudge in vendor/radar-0.12.js
        const viewBoxSize = (radarRadius + padding) * 2;
        // Center the viewBox on the radar (which is centered at size/2, size/2)
        const viewBoxX = (size / 2) - (radarRadius + padding);
        const viewBoxY = (size / 2) - (radarRadius + padding) + nudgeY;
        svg.attr("viewBox", `${viewBoxX} ${viewBoxY} ${viewBoxSize} ${viewBoxSize}`);

        // Add quadrant labels relative to the radar center
        try {
          const radarG = svg.select('g'); // Get the main radar group
          const offset = 260; // Position labels inside the rings
          const labels = [
            { text: QUADRANTS[0].name, x: offset, y: offset }, // bottom-right
            { text: QUADRANTS[1].name, x: -offset, y: offset }, // bottom-left
            { text: QUADRANTS[2].name, x: -offset, y: -offset }, // top-left
            { text: QUADRANTS[3].name, x: offset, y: -offset }, // top-right
          ];
          const qg = radarG.append('g').attr('class', 'quadrant-labels');
          labels.forEach(l => {
            qg.append('text')
              .attr('class', 'quadrant-label')
              .attr('x', l.x)
              .attr('y', l.y)
              .attr('text-anchor', 'middle')
              .text(l.text);
          });
        } catch (e) {
          // ignore
        }

        // Set library exact height to fill viewport
        // No JS height setting; CSS handles full height with calc()

        // Index blips by label and enable hover highlight
        // Wait a bit for radar library to finish rendering
        setTimeout(() => indexAndBindHover(), 100);
      }

      // default radar behavior (no logo customization)

      function buildFilters() {
        const qSel = document.getElementById("quadrantFilter");
        const rSel = document.getElementById("ringFilter");
        qSel.innerHTML = `<option value="">All quadrants</option>` + QUADRANTS.map((q, i) => `<option value="${i}">${q.name}</option>`).join("");
        rSel.innerHTML = `<option value="">All rings</option>` + RINGS.map((r, i) => `<option value="${i}">${r.name}</option>`).join("");

        // Build compact ring legend
        const legend = document.getElementById('ringLegend');
        legend.innerHTML = RINGS.map((r, i) => `<span><span class="ring-dot" style="background:${r.color}"></span>${r.name}</span>`).join(' · ');
      }

      function renderList() {
        const list = document.getElementById("list");
        const lib = document.querySelector('.library');
        const search = (document.getElementById("search").value || "").toLowerCase();
        const q = document.getElementById("quadrantFilter").value;
        const r = document.getElementById("ringFilter").value;
        const items = RADAR_ENTRIES.filter(e =>
          (!search || e.label.toLowerCase().includes(search)) &&
          (!q || String(e.quadrant) === q) &&
          (!r || String(e.ring) === r)
        ).sort((a, b) => {
          // ring ordering first, then label
          const ra = RING_ORDER.indexOf(a.ring);
          const rb = RING_ORDER.indexOf(b.ring);
          if (ra !== rb) return ra - rb;
          return a.label.localeCompare(b.label);
        });

        list.innerHTML = items.map(e => {
          const letter = (e.label || '?').trim().charAt(0).toUpperCase();
          const logoHtml = e.logo
            ? `<img class=\"logo\" src=\"${e.logo}\" alt=\"\" aria-hidden=\"true\" onerror=\"this.replaceWith(Object.assign(document.createElement('div'),{className:'logo-letter',textContent:'${letter}'}))\">`
            : `<div class=\"logo-letter\" aria-hidden=\"true\">${letter}</div>`;
          return `
          <div class="item" data-label="${e.label}">
              ${logoHtml}
              <div>
            <div class="name">${e.label}
              <span class="badge ring-${e.ring}">${RINGS[e.ring].name}</span>
            </div>
            <div class="meta">${QUADRANTS[e.quadrant].name}</div>
          </div>
            </div>
          `;
        }).join("");

        list.querySelectorAll('.item').forEach(el => {
          const label = el.dataset.label;
          el.addEventListener('click', () => selectLibraryItem(label));
          el.addEventListener('mouseenter', () => highlightBlip(label));
          el.addEventListener('mouseleave', () => clearHighlight());
        });

        // Toggle one-result layout hint for the library panel
        if (lib) {
          lib.classList.toggle('one-result', items.length === 1);
        }
      }

      function showDetails(label) {
        const e = RADAR_ENTRIES.find(x => x.label === label);
        const box = document.getElementById("details");
        const lib = document.querySelector('.library');
        if (!e) { box.hidden = true; if (lib) lib.classList.remove('has-selection'); return; }
        const links = (e.links || []).map(l => `<a href="${l.url}" target="_blank" rel="noopener">${l.title}</a>`).join(" · ");
        const letter = (e.label || '?').trim().charAt(0).toUpperCase();
        const logo = e.logo
          ? `<img class=\"logo\" src=\"${e.logo}\" alt=\"\" aria-hidden=\"true\" onerror=\"this.replaceWith(Object.assign(document.createElement('div'),{className:'logo-letter',textContent:'${letter}'}))\">`
          : `<div class=\"logo-letter\" aria-hidden=\"true\">${letter}</div>`;
        box.innerHTML = `
          <button class="close-btn" aria-label="Close details" title="Close">&times;</button>
          <div class="detail-header">
            ${logo}
            <div>
              <h3 style="margin:0">${e.label} <span class="badge">${RINGS[e.ring].name}</span></h3>
          <div class="meta">${QUADRANTS[e.quadrant].name}${links ? ' · ' + links : ''}</div>
            </div>
          </div>
          <p>${e.summary || ''}</p>
          ${e.decision ? `<p><strong>Decision:</strong> ${e.decision}</p>` : ''}
          ${Array.isArray(e.when_to_use) && e.when_to_use.length > 0 ? `<p><strong>Use for</strong></p><ul>${e.when_to_use.map(x => `<li>${x}</li>`).join('')}</ul>` : ''}
          ${Array.isArray(e.consider_alternitive) && e.consider_alternitive.length > 0 ? `<p><strong>Consider alternatives when</strong></p><ul>${e.consider_alternitive.map(x => `<li>${x}</li>`).join('')}</ul>` : ''}
        `;
        box.hidden = false;
        // Expand details area when a selection is shown
        if (lib) lib.classList.add('has-selection');

        // Close behavior
        const close = box.querySelector('.close-btn');
        if (close) {
          close.addEventListener('click', () => {
            // Hide details and clear selection state
            box.hidden = true;
            if (lib) lib.classList.remove('has-selection');
            document.querySelectorAll('.item.selected').forEach(el => el.classList.remove('selected'));
            // Clear radar highlight
            clearHighlight();
          });
        }
      }

      function indexAndBindHover() {
        const svg = d3.select('#radar');
        // Map label to g.blip
        const labelToBlip = new Map();
        svg.selectAll('g.blip').each(function() {
          const g = d3.select(this);
          const titleSel = g.select('title');
          const label = titleSel.empty() ? '' : (titleSel.text() || '').trim();
          if (label) {
            labelToBlip.set(label, g);
            
            // Make blips clickable - bind to all child elements too
            g.style('cursor', 'pointer');
            g.selectAll('*').style('cursor', 'pointer');
            
            // Bind click to the group and all children
            [g, ...g.selectAll('circle, polygon, path, text').nodes().map(n => d3.select(n))].forEach(el => {
              el.on('click', function(event) {
                event.stopPropagation();
                event.preventDefault();
                console.log('Clicked:', label); // Debug log
                selectLibraryItem(label);
              });
            });
          }
        });
        window.__labelToBlip = labelToBlip;
        console.log('Indexed', labelToBlip.size, 'blips'); // Debug log
      }

      function highlightBlip(label) {
        const svg = d3.select('#radar');
        const map = window.__labelToBlip || new Map();
        const target = map.get(label);
        if (!target) return;
        svg.selectAll('g.blip').classed('dim', true).classed('highlighted', false);
        target.classed('dim', false).classed('highlighted', true);
      }

      function clearHighlight() {
        const svg = d3.select('#radar');
        svg.selectAll('g.blip').classed('dim', false).classed('highlighted', false);
      }

      function selectLibraryItem(label) {
        const lib = document.querySelector('.library');
        // Remove previous selections
        document.querySelectorAll('.item.selected').forEach(el => el.classList.remove('selected'));
        
        // Find and select the item
        const listItem = document.querySelector(`.item[data-label="${label}"]`);
        if (listItem) {
          // Mark as selected
          listItem.classList.add('selected');
          
          // Scroll into view
          listItem.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Add highlight animation
          listItem.classList.add('highlighted');
          setTimeout(() => listItem.classList.remove('highlighted'), 1500);
        }
        
        // Show details
        showDetails(label);
        if (lib) lib.classList.add('has-selection');
      }

      // ====================================
      // Initial Drawing and Event Setup
      // ====================================
      function initializeRadar() {
        buildFilters();
        ['search','quadrantFilter','ringFilter'].forEach(id => document.getElementById(id).addEventListener('input', renderList));
        drawRadar();
        renderList();
      }

      window.addEventListener("resize", () => {
        // Debounce a little to avoid excessive redraws
        clearTimeout(window.__radarRedraw);
        window.__radarRedraw = setTimeout(drawRadar, 100);
      });

      // Make selectLibraryItem globally accessible
      window.selectLibraryItem = selectLibraryItem;

      // Kick off data load
      loadEntries();
</script>
  </body>
</html>